# Workflows for automatic evaluation of bioassays (AutomatizedBioassayScreening)
Details on how to use provided R scripts which can be used for the analysis of cell-based bioassay raw data for a variety of high-throughput assays in a 384-well plate format. Description of the files needed. 

---

# Structure of the environment

The environment has a distinct hierarchy of folders and files. 
1 The main folder is the `project` folder which acts as main environment and can be created at the desired path. 
 1.1 This project folder contains a `Summary.xlsx` which has two sheets.
  - The first sheet  `Sample_List` has to be filled with the green columns.
   - Sample_description: A place for comments and more detailled sample descriptions.
   - Sample_ID: An unique ID of a sample. If an ID is occuring several times, one has to define if those measurements are merged or split by defining the respective `yaml` file in the assay folders. 
   - Unit: The concentration unit used.
   - Assay_ID: The ID used for respective assays, i.e. AREc32 or MMP. Can be extended as desired. Needs to match the names of the `assay` folders. If the respective sample was measured in this assay, one has to add a "x" to the respective Assay_ID column. 
  - The orange columns will be filled in by the scripts. Filled-in files will get the suffix "_Assay_ID_filled, where the Assay_ID will be the respective Assay_ID as defined by the user. 
   - Measurmement: Will be the name of the folder containing the raw data measurememnts.
   - Plate: The number of the plate.
   - Position: The row of the plate where the sample was dosed.

2 The `assay` folders which have specified names of the respective assays, i.e. AREc32 or MMP.
 2.1 All folders within this `assay` folder are considered `measurements` containing raw data files.
  2.1.1 Each `measurement` includes the `dosing.xlsx` which is defining how the samples were dosed. The sheet sample_data is the only one which needs to be filled in, whilst the other sheets are linked and used by the scripts for dosed concentrations. Concentrations are calculated for two scenarios, linear or serial dilution per plate. 
   - Green columns have to be filled in. Sample_description, Sample_ID, and Sample_concentration_unit can directly be copied and pasted into the `Summary.xlsx`.
    - Plate: The number of the plate. Currently limited to 5 plates per `measurement`.
    - Col.: The column of the 384-well plate.
    - Sample_description: A place for comments and more detailled sample descriptions.
    - Sample_ID: An unique ID of a sample. If an ID is occuring several times, one has to define if those measurements are merged or split by defining the respective `yaml` file in the assay folders. 
    - Sample_concentration_unit: The concentration unit used.
    - Dosing: Define if the script should use the linear or serial dilution pattern of the respective plate. Also affects calculations of the lowest and highest concentrations dosed.
    - Sample_concentration_value: The concentration value of the initial sample in the sample_concentration_unit.
    - Blow_down?: Was the sample evaporated before adding medium? If not empty, the calculations will be done assuming full evaporation of the added sample volume.
    - target_conc_assay: What is the targeted highest concentration dosed to the cells? (mutually exclusive with target_µL_of_sample).
    - target_µL_of_sample: What is the volume of sample added to the dosing vial? (mutually exclusive with target_conc_assay).
    - µL_medium: The amount of assay medium added to the dosing vial.
    - Dilution: The ratio of dosed sample to original sample. Helps identifying necessary dilutions if target_conc_assay is not within a feasable range of volumes.
   - Orange columns are calculated by equations within the sheet.
    - µL_total: The final volume of the dosing vial.
    - µL_of_sample: The volume of sample added to the dosing vial.
    - conc_dosing_vial: The concentration of the sample in the dosing vial.
    - high_conc_assay: The highest concentration dosed to the assay plate.
    - low_conc_assay: The lowest concentration dosed to the assay plate.
  2.1.2 A "Plots" folder which will be generated by the R script if it is not already exisiting
    - Contains .PDF files which show the final plots
     - Left (A) plot is a summary of all measured data points of both, effect and cytotoxicity 
     - Middle (B) plot shows the data and fit used to derive effect concentrations (selected enpoint)
     - Right (C) plot shows the data and fit used to derive inhibitory concentrations (cytotoxicity)
     - If both linear and log-logistic plots are to be plotted, the upper row (A - C) will plot the values on a linear scale whilst the lower row (D - F) will show the values on a logarithmic scale
 2.2 The R script used for the analysis of the assay
 2.3 The `yaml` file defining the analysis settings
   - Reference: The ID of the reference compound used in the assay. This has to match the IDs of used in the `Summary.xlsx` or `dosing.xlsx`
   - combine_repeats: Boolean if data of reoccuring IDs should be merged (TRUE) or analyzed seperately (FALSE)
   - which_plots: Define if you want to only plot the "linear", "log", or "all" plots. 
   - use_letters_for_subplots: Define if you want to plot the respective letters (A - C, A - F) on the subplots.
   - cytotoxicity_cutoff: Define if you want to trim the concentration-response curve to a maximum of the measured IC10 (concentration at 10% cytotoxicity). 

# Setup of the environment

1) Create the `projects` folder wherever you like. It is suggested to have a folder which contains all projects to later on have an easier work environment for inter-project analyses. 
2) Add a `Summary.xlsx`. This repository provides a template. 
3) Add a `bioassay` folder. The name of the `bioassay` folder needs to match the Assay_ID used in the `Summary.xlsx`, i.e. AREc32 or MMP. 
4) Add the `measurememnts` to your `assay` folder. These folders should contain the `dosing.xlsx` as well as .xlsx and .txt of the raw data. A measurement is currently limited to 5 plates and nees to be split with restarting plates (so i.e. measurement_X_1 has plates 1 - 5, and measurement_X_2 has the plates 6 - 8 but are filled in as plates 1 - 3. 
 - .txt: Should contain the information of incubation time (24h or 48h) as well as the plate (_p1, _p2, ...). 
 - .xlsx: Only one sheet and should contain a label ("Image" for MMP, "RawData" for all other assays) and the plate (_p1, _p2, ...).
5) Update `Summary.xlsx` in accordance with the `dosing.xlsx`, so that Sample_description, Sample_ID, and Unit/Sample_concentration_unit match and select the bioassays that have been measured per sample
6) Add a yaml file and define the parameters as needed

# Data evaluation

Add the respective R script designed for the assay and run all lines. The script will generate a "Plots" folder within the `bioassay` folder and a `Summary_Assay_ID_filled.xlsx` will be generated showin plate coordinates and benchmark concentrations of all selected samples

# Data interpretation

The filled in `Summary_Assay_ID_fille.xlsx` will contain several columns with results. Assay_ID is the ID which is used for the respective assay, i.e. "AREc32" or "MMP"
 - Sample_ID: An unique ID of a sample. If an ID is occuring several times, one has to define if those measurements are merged or split by defining the respective `yaml` file in the assay folders. 
 - Unit: The concentration unit used.
 - Assay_ID_lin_EC10: The EC10 value derived using linear regression
 - Assay_ID_log_EC50: The EC50 value derived using log-logistic regression
 - SE_Assay_ID_lin_EC10: The standard error of the EC10 value derived using linear regression
 - R2_Assay_ID_lin_EC10: The coefficient of determination of the linear regression line used to derive EC10
 - Assay_ID_log_EC10: The EC10 value derived using log-logistic regression
 - SE_Assay_ID_log_EC10: The standard error of the EC10 value derived using log-logistic regression
 - R2_Assay_ID_log_EC10: The Cox-Snell coefficient of determination of the log-logistic fit used to derive EC10
 - Assay_ID_Effect_dev_Control: Boolean if the measured effect values differ significantly from the control of unexposed cells
 - Assay_ID_lin_IC10: The IC10 value derived using linear regression
 - Assay_ID_log_IC50: The IC50 value derived using log-logistic regression
 - SE_Assay_ID_lin_IC10: The standard error of the IC10 value derived using linear regression
 - R2_Assay_ID_lin_IC10: The coefficient of determination of the linear regression line used to derive IC10
 - Assay_ID_log_IC10: The IC10 value derived using log-logistic regression
 - SE_Assay_ID_log_IC10: The standard error of the IC10 value derived using log-logistic regression
 - R2_Assay_ID_log_IC10: The Cox-Snell coefficient of determination of the log-logistic fit used to derive IC10
 - Assay_ID_Cytotoxicity_dev_Control: Boolean if the measured cytotoxicity values differ significantly from the control of unexposed cells

It is suggested to not only check for valid R2, but also consider if the values are significantly different from the control of unexposed cells. Further, one should decide for one final regression model within a project to ensure comparable results. 